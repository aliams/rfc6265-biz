<!DOCTYPE html>
<script src="/tests/resources/testharness.js"></script>
<script src="/tests/resources/testharnessreport.js"></script>
<script src="/tests/resources/cookie-helper.js"></script>
<script>
  function create_read_test(secure_origin, secure_cookie, cookie_expected, title) {
    promise_test(t => {
      var value = "" + Math.random();
      if (secure_origin == true) {
         //redirect to proper origin for test 
      }
      
      //TODO before this test, ensure secure-origin server sends set-cookie call to erase all existing alone-cookies
      forceEraseAllAloneCookies();

      //TODO change this to "retrieve secure cookie from secure-origin server directly"
      resetAloneCookiesfromServer(value, secure_cookie);
      verifyAloneCookieState(value, cookie_expected);
    }, title);
  }

  function create_write_test(secure_origin, secure_cookie, cookie_expected, title) {
    promise_test(t => {
      var value = "" + Math.random();
      if (secure_origin == true) {
         //redirect to proper origin for test 
      }

      //TODO before this test, ensure secure-origin server sends set-cookie call to erase all existing alone-cookies
      forceEraseAllAloneCookies();

      resetAloneCookiesFromJavaScript(value, secure_cookie);
      verifyAloneCookieState(value, cookie_expected);
    }, title);
  }


  //actual tests to verify that non-secure origins should "leave secure cookies alone"
  create_read_test(false, true, false, "non-secure origins using document.cookie cannot read secure cookies");
  create_write_test(false, true, false, "non-secure origins using document.cookie cannot write secure cookies");

  //all UA's should pass this test that show non-secure origins can read and write insecure cookies
  create_read_test(false, false, true, "non-secure origins using document.cookie can read insecure cookies");
  create_write_test(false, false, true, "non-secure origins using document.cookie can write insecure cookies");

  //tests that show secure origins can read and write both secure and insecure cookies
  create_read_test(true, false, true, "secure origins using document.cookie can read insecure cookies");
  create_write_test(true, false, true, "secure origins using document.cookie can write insecure cookies");

  //these (and others?) are likely broken until we can test on a live HTTPS site
  create_read_test(true, true, true, "secure origins using document.cookie can read secure cookies");
  create_write_test(true, true, true, "secure origins using document.cookie can write secure cookies");
</script>