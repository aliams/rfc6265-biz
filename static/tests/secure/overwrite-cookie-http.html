<!DOCTYPE html>
<script src="/tests/resources/testharness.js"></script>
<script src="/tests/resources/testharnessreport.js"></script>
<script src="/tests/resources/cookie-helper.js"></script>
<script>
  //origin is who sets the cookie
  //target is who tries to send cookie
  function create_test(target, expectedStatus, title) {
    promise_test(t => {
      //force cookie update securely
      var value = "" + Math.random();
      return resetSecureCookies(SECURE_CROSS_SITE_ORIGIN, value)
        .then(_ => {
          return credFetch(SECURE_CROSS_SITE_ORIGIN + "/cookie/list")
            .then(r => r.json())
            .then(cookies => overwriteSecureCookie(target, expectedStatus, value, cookies));
        });
    }, title);
  }

  //secure cookie should not be overwritten by insecure origin
  create_test(INSECURE_CROSS_SITE_ORIGIN, SecureStatus.SECURE_NOT_MODIFIED, "Secure cookies should not be overwritten by insecure origins");
  //secure cookie should be overwritten by secure origin
  create_test(SECURE_CROSS_SITE_ORIGIN, SecureStatus.SECURE_MODIFIED, "Secure cookies should be overwritten by secure origins")
</script>